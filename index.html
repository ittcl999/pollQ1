<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ตรวจสอบสิทธิ์การตอบแบบสำรวจ</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      font-family: 'Prompt', sans-serif;
      text-align: center;
      padding-top: 100px;
    }
  </style>
</head>
<body>
  <h2>กำลังตรวจสอบข้อมูลของคุณ...</h2>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz9fvC2qb0TE4ZClFDUjHhjvonZCdrT8eCGFSgQzI5ifKU_HBEP0pv7nWejmOxFpitR/exec';
    const username = localStorage.getItem('username');

    if (!username) {
      Swal.fire({
        icon: 'error',
        title: 'ไม่พบข้อมูลผู้ใช้',
        text: 'กรุณาเข้าสู่ระบบใหม่',
        confirmButtonText: 'กลับหน้า Login'
      }).then(() => {
        window.location.href = 'login.html';
      });
    } else {
      Swal.fire({
        title: 'กำลังตรวจสอบ...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
      });

      const url = `${SCRIPT_URL}?action=checkAnswered&username=${encodeURIComponent(username)}&callback=handleCheck`;

      const script = document.createElement('script');
      script.src = url;
      document.body.appendChild(script);
    }

    function handleCheck(response) {
      Swal.close();
      if (response.answered) {
        Swal.fire({
          icon: 'info',
          title: 'คุณได้ตอบแบบสำรวจแล้ว',
          text: 'ขอบคุณที่ให้ความร่วมมือ',
          confirmButtonText: 'ตกลง'
        });
      } else {
        window.location.href = 'poll.html';
      }
    }
  </script>
</body>
</html>
